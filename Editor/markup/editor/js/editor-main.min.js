!function(e){"use strict";e.fn.editorCustom=function(){var t;return function(){var n,o,i;if(t)throw Error("There is can be only one instance of editor");t=this,i=function(t,n){var o=e("<"+t+">");if("object"!=typeof n)throw Error("*"+0/0*n);for(var i in n)n.hasOwnProperty(i)&&o.attr(i,n[i]);return o},n=i("iframe",{id:"editor",text:"Your browser does`t support iframes"}).appendTo(this),setTimeout(function(){function r(e,t,n){this.applier=rangy.createClassApplier(t,{elementTagName:n,ignoreWhiteSpace:!1}),this.btn=c(e)}var s,a,c,d=n[0].contentDocument?n[0].contentDocument:n[0].contentDocument?n[0].contentWindow.document:n[0].document,l=n[0].contentWindow||n[0].contentDocument.defaultView,u=d.createDocumentFragment(),p=e(d).find("head"),h=e(d).find("body");c=function(e){return d.getElementById(e)},i("link",{rel:"stylesheet",href:'editor/css/iframe-style.min.css?t=<?= time(); ?>"'}).appendTo(p),i("script",{src:"editor/js/uncompressed/libs/lib.min.js"}).appendTo(p),i("input",{type:"button",id:"toggleBold",value:"B"}).appendTo(u),i("input",{type:"button",id:"toggleUnderline",value:"U"}).appendTo(u),i("input",{type:"button",id:"toggleItalic",value:"I"}).appendTo(u),i("input",{type:"button",id:"toggleDelete",value:"Del"}).appendTo(u),h.append(u),i("div",{contenteditable:"true",id:"edit"}).appendTo(h),s=e(c("edit")),a=s.html(),o=function(){var t=["height="+screen.height,"width="+screen.width,"top=0","left=0","resizable=yes","scrollbars=yes","toolbar=yes","menubar=yes","location=yes"].join(","),n=window.open("","myEditor",t);return e(n.document.body).ready(function(){var t=a;n.document.write('<html><head><title>Preview</title><link rel="stylesheet" type="text/css" href="editor/css/preview.min.css?t=<?= time(); ?>"></head><body>'),e(n.document.body).html(t),n.document.write("</body></html>")}),n.document.close(),window.focus&&n.focus(),!1},r.prototype={toggleStyle:function(){this.applier.toggleSelection(l)},attachEvents:function(){var t=this;e(d).on("empty",function(){(""===a||/^((<(b|i|del|u)\sclass=".{1,4}"><br><\/\3>)|<br>)$/.test(a))&&(s.empty(),t.applier.undoToSelection(l))}),e(d).on("keyup",function(t){var n=t.which||t.keyCode||t.charCode;/^(<(strong|strike|em|ins|u)(.+)?>.+<\/\2>)$/.test(a)&&s.html(a),(8===n||46===n)&&(e.trim(a),e(d).trigger("empty"))}),this.btn.ontouchstart=this.btn.onmousedown=function(){this.toggleStyle()}.bind(this)}},rangy.init();var m=rangy.modules.ClassApplier;return rangy.supported&&m&&m.supported&&(new r("toggleBold","bold","b").attachEvents(),new r("toggleUnderline","und","b").attachEvents(),new r("toggleItalic","ita","i").attachEvents(),new r("toggleDelete","del","del").attachEvents()),e(".preview").on("click",function(){o()}),t},100)}}()}(jQuery);