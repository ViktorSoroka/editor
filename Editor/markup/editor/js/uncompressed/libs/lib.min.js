!function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==R||!(n!=v||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=v||!e[t])}function n(e,t){return typeof e[t]!=C}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function o(e){return e&&T(e,S)&&O(e,y)}function i(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(){typeof console!=C&&e(console,"log")}function s(e,t){_&&t?alert(e):a(e)}function c(e){D.initialized=!0,D.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,D.config.alertOnFail)}function f(e){s("Rangy warning: "+e,D.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function l(){if(_&&!D.initialized){var t,n=!1,r=!1;e(document,"createRange")&&(t=document.createRange(),T(t,E)&&O(t,N)&&(n=!0));var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void c("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(r=!0)),!n&&!r)return void c("Neither Range nor TextRange are available");D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:r};var f,l;for(var u in x)(f=x[u])instanceof h&&f.init(f,D);for(var g=0,p=H.length;p>g;++g)try{H[g](D)}catch(m){l="Rangy init listener threw an exception. Continuing. Detail: "+d(m),a(l)}}}function u(e){e=e||window,l();for(var t=0,n=B.length;n>t;++t)B[t](e)}function h(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function g(e,t,n){var r=new h(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(D,t),t.supported=!0}catch(r){var o="Module '"+e+"' failed to load: "+d(r);a(o),r.stack&&a(r.stack)}}});return x[e]=r,r}function p(){}function m(){}var v="object",R="function",C="undefined",N=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],E=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],y=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],S=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=r(e),w=r(t),O=r(n),A=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;r>n;++n)t(e[n],n)},x={},_=typeof window!=C&&typeof document!=C,b={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:T,areHostObjects:w,areHostProperties:O,isTextRange:o,getBody:i,forEach:A},D={version:"1.3.0-beta.1",initialized:!1,isBrowser:_,supported:!0,util:b,features:{},modules:x,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==C?!0:rangyAutoInitialize}};D.fail=c,D.warn=f;var P;({}).hasOwnProperty?(b.extend=P=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&P(r,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},b.createOptions=function(e,t){var n={};return P(n,t),e&&P(n,e),n}):c("hasOwnProperty not supported"),_||c("Rangy can only run in a browser"),function(){var e;if(_){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){for(var t=[],n=0,r=e.length;r>n;++n)t[n]=e[n];return t}),b.toArray=e}();var I;_&&(e(document,"addEventListener")?I=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?I=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),b.addListener=I);var H=[];D.init=l,D.addInitListener=function(e){D.initialized?e(D):H.push(e)};var B=[];D.addShimListener=function(e){B.push(e)},_&&(D.shim=D.createMissingNativeApi=u),h.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;o>r;++r){if(t=n[r],e=x[t],!(e&&e instanceof h))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){D.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){D.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},D.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=g(e,n,t);D.initialized&&D.supported&&r.init()},D.createCoreModule=function(e,t,n){g(e,t,n)},D.RangePrototype=p,D.rangePrototype=new p,D.selectionPrototype=new m,D.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==_||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(I(r,n))return n;return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t){return s(e,t,!0)}function f(e,t,n){for(var r,o=n?e:e.parentNode;o;){if(r=o.parentNode,r===t)return o;o=r}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function l(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function u(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function h(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),u(r,e),n)for(var i,a=0;i=n[a++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;return r}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=_)return e.ownerDocument;if(typeof e.document!=_)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=g(e);if(typeof n.defaultView!=_)return n.defaultView;if(typeof n.parentWindow!=_)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=_)return e.contentDocument;if(typeof e.contentWindow!=_)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=_)return e.contentWindow;if(typeof e.contentDocument!=_)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function R(e){return e&&b.isHostMethod(e,"setTimeout")&&b.isHostObject(e,"document")}function C(e,t,n){var r;if(e?b.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):R(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function N(e){for(var t;t=e.parentNode;)e=t;return e}function E(e,n,r,i){var s,c,d,l,u;if(e==r)return n===i?0:i>n?-1:1;if(s=f(r,e,!0))return n<=o(s)?-1:1;if(s=f(e,r,!0))return o(s)<i?-1:1;if(c=a(e,r),!c)throw new Error("comparePoints error: nodes have no common ancestor");if(d=e===c?c:f(e,c,!0),l=r===c?c:f(r,c,!0),d===l)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(u=c.firstChild;u;){if(u===d)return-1;if(u===l)return 1;u=u.nextSibling}}function y(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function S(e){if(!e)return"[No node]";if(H&&y(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function T(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function w(e){this.root=e,this._next=e}function O(e){return new w(e)}function A(e,t){this.node=e,this.offset=t}function x(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var _="undefined",b=e.util;b.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),b.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var D=document.createElement("div");b.areHostMethods(D,["insertBefore","appendChild","cloneNode"]||!b.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),b.isHostProperty(D,"innerHTML")||t.fail("Element is missing innerHTML property");var P=document.createTextNode("test");b.areHostMethods(P,["splitText","deleteData","insertData","appendData","cloneNode"]||!b.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"])||!b.areHostProperties(P,["data"]))||t.fail("Incomplete Text Node implementation");var I=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},H=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",H=y(n),e.features.crashyTextNodes=H}();var B;typeof window.getComputedStyle!=_?B=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=_?B=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+S(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},x.prototype.toString=function(){return this.message},e.dom={arrayContains:I,isHtmlNamespace:n,parentElement:r,getNodeIndex:o,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:c,getClosestAncestorIn:f,isCharacterDataNode:d,isTextOrCommentNode:l,insertAfter:u,splitDataNode:h,getDocument:g,getWindow:p,getIframeWindow:v,getIframeDocument:m,getBody:b.getBody,isWindow:R,getContentDocument:C,getRootContainer:N,comparePoints:E,isBrokenNode:y,inspectNode:S,getComputedStyleProperty:B,fragmentFromNodeChildren:T,createIterator:O,DomPosition:A},e.DOMException=x}),D.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(F(e,t.startContainer)||F(e,t.endContainer))}function n(e){return e.document||j(e.startContainer)}function r(e){return new M(e.parentNode,k(e))}function o(e){return new M(e.parentNode,k(e)+1)}function i(e,t,n){var r=11==e.nodeType?e.firstChild:e;return L(t)?n==t.length?H.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:U(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function a(e,t,r){if(T(e),T(t),n(t)!=n(e))throw new W("WRONG_DOCUMENT_ERR");var o=z(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=z(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?0>=o&&i>=0:0>o&&i>0}function s(e){for(var t,r,o,i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(o=e.getSubtreeIterator(),r.appendChild(s(o)),o.detach()),10==r.nodeType)throw new W("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function c(e,t,n){var r,o;n=n||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,n),a.detach(),n.stop)return}else for(r=H.createIterator(i);o=r.next();)if(t(o)===!1)return void(n.stop=!0)}function f(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),f(t),t.detach()):e.remove()}function d(e){for(var t,r,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach()):e.remove(),10==t.nodeType)throw new W("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function l(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new h(e,!1),function(t){if(!(o&&!r.test(t.nodeType)||i&&!n(t))){var s=e.startContainer;if(t!=s||!L(s)||e.startOffset!=s.length){var c=e.endContainer;t==c&&L(c)&&0==e.endOffset||a.push(t)}}}),a}function u(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+H.inspectNode(e.startContainer)+":"+e.startOffset+", "+H.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&L(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||L(this.sc)?V(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||L(this.ec)?V(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,Y(e,r))return o;o=o.parentNode}return null}}function p(e,t){if(nt(e,t))throw new W("INVALID_NODE_TYPE_ERR")}function m(e,t){if(!Y(t,e.nodeType))throw new W("INVALID_NODE_TYPE_ERR")}function v(e,t){if(0>t||t>(L(e)?e.length:e.childNodes.length))throw new W("INDEX_SIZE_ERR")}function R(e,t){if(et(e,!0)!==et(t,!0))throw new W("WRONG_DOCUMENT_ERR")}function C(e){if(tt(e,!0))throw new W("NO_MODIFICATION_ALLOWED_ERR")}function N(e,t){if(!e)throw new W(t)}function E(e){return Q&&H.isBrokenNode(e)||!Y(X,e.nodeType)&&!et(e,!0)}function y(e,t){return t<=(L(e)?e.length:e.childNodes.length)}function S(e){return!!e.startContainer&&!!e.endContainer&&!E(e.startContainer)&&!E(e.endContainer)&&y(e.startContainer,e.startOffset)&&y(e.endContainer,e.endOffset)}function T(e){if(!S(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function w(e,t){T(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;L(o)&&i>0&&i<o.length&&U(o,i,t),L(n)&&r>0&&r<n.length&&(n=U(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=k(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function O(e){T(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function A(e){e.START_TO_START=ct,e.START_TO_END=ft,e.END_TO_END=dt,e.END_TO_START=lt,e.NODE_BEFORE=ut,e.NODE_AFTER=ht,e.NODE_BEFORE_AND_AFTER=gt,e.NODE_INSIDE=pt}function x(e){A(e),A(e.prototype)}function _(e,t){return function(){T(this);var n,r,i=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,f=new h(this,!0);i!==s&&(n=V(i,s,!0),r=o(n),i=r.node,a=r.offset),c(f,C),f.reset();var d=e(f);return f.detach(),t(this,i,a,i,a),d}}function b(n,i){function a(e,t){return function(n){m(n,G),m($(n),X);var i=(e?r:o)(n);(t?s:c)(this,i.node,i.offset)}}function s(e,t,n){var r=e.endContainer,o=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&(($(t)!=$(r)||1==z(t,n,r,o))&&(r=t,o=n),i(e,t,n,r,o))}function c(e,t,n){var r=e.startContainer,o=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&(($(t)!=$(r)||-1==z(t,n,r,o))&&(r=t,o=n),i(e,r,o,t,n))}var l=function(){};l.prototype=e.rangePrototype,n.prototype=new l,B.extend(n.prototype,{setStart:function(e,t){p(e,!0),v(e,t),s(this,e,t)},setEnd:function(e,t){p(e,!0),v(e,t),c(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],r=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:r=e[2],o=e[3]}i(this,t,n,r,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){T(this),e?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){p(e,!0),i(this,e,0,e,q(e))},selectNode:function(e){p(e,!1),m(e,G);var t=r(e),n=o(e);i(this,t.node,t.offset,n.node,n.offset)},extractContents:_(d,i),deleteContents:_(f,i),canSurroundContents:function(){T(this),C(this.startContainer),C(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},splitBoundaries:function(){w(this)},splitBoundariesPreservingPositions:function(e){w(this,e)},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(o){var i=o.previousSibling;if(i&&i.nodeType==o.nodeType){e=o;var a=o.length;if(t=i.length,o.insertData(0,i.data),i.parentNode.removeChild(i),e==n)r+=t,n=e;else if(n==o.parentNode){var s=k(o);r==s?(n=o,r=a):r>s&&r--}}},s=!0;if(L(n))n.length==r&&o(n);else{if(r>0){var c=n.childNodes[r-1];c&&L(c)&&o(c)}s=!this.collapsed}if(s){if(L(e))0==t&&a(e);else if(t<e.childNodes.length){var f=e.childNodes[t];f&&L(f)&&a(f)}}else e=n,t=r;i(this,e,t,n,r)},collapseToPoint:function(e,t){p(e,!0),v(e,t),this.setStartAndEnd(e,t)}}),x(n)}function D(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:H.getCommonAncestor(e.startContainer,e.endContainer)}function P(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=H.getDocument(t),D(e)}function I(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,D(this)}var H=e.dom,B=e.util,M=H.DomPosition,W=e.DOMException,L=H.isCharacterDataNode,k=H.getNodeIndex,F=H.isOrIsAncestorOf,j=H.getDocument,z=H.comparePoints,U=H.splitDataNode,V=H.getClosestAncestorIn,q=H.getNodeLength,Y=H.arrayContains,$=H.getRootContainer,Q=e.features.crashyTextNodes;h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,L(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!L(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new I(n(this.range));var t=this._current,r=t,o=0,i=t,a=q(t);F(t,this.sc)&&(r=this.sc,o=this.so),F(t,this.ec)&&(i=this.ec,a=this.eo),P(e,r,o,i,a)}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var G=[1,3,4,5,7,8,10],X=[2,9,11],Z=[5,6,10,12],J=[1,3,4,5,7,8,10,11],K=[1,3,4,5,7,8],et=g([9,11]),tt=g(Z),nt=g([6,10,12]),rt=document.createElement("style"),ot=!1;try{rt.innerHTML="<b>x</b>",ot=3==rt.firstChild.nodeType}catch(it){}e.features.htmlParsingConforms=ot;var at=ot?function(e){var t=this.startContainer,n=j(t);if(!t)throw new W("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:L(t)&&(r=H.parentElement(t)),r=null===r||"HTML"==r.nodeName&&H.isHtmlNamespace(j(r).documentElement)&&H.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,H.fragmentFromNodeChildren(r)}:function(e){var t=n(this),r=t.createElement("body");return r.innerHTML=e,H.fragmentFromNodeChildren(r)},st=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ct=0,ft=1,dt=2,lt=3,ut=0,ht=1,gt=2,pt=3;B.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){T(this),R(this.startContainer,t.startContainer);var n,r,o,i,a=e==lt||e==ct?"start":"end",s=e==ft||e==ct?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],z(n,r,o,i)},insertNode:function(e){if(T(this),m(e,J),C(this.startContainer),F(e,this.startContainer))throw new W("HIERARCHY_REQUEST_ERR");var t=i(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&L(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new h(this,!0);return e=s(r),r.detach(),e},canSurroundContents:function(){T(this),C(this.startContainer),C(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(m(e,K),!this.canSurroundContents())throw new W("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);i(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new I(n(this)),r=st.length;r--;)e=st[r],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&L(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new h(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=k(e);if(!t)throw new W("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>r?o>0?gt:ut:o>0?ht:pt},comparePoint:function(e,t){return T(this),N(e,"HIERARCHY_REQUEST_ERR"),R(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)<0?-1:z(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:at,toHtml:function(){return O(this)},intersectsNode:function(e,t){if(T(this),N(e,"NOT_FOUND_ERR"),j(e)!==n(this))return!1;var r=e.parentNode,o=k(e);N(r,"NOT_FOUND_ERR");var i=z(r,o,this.endContainer,this.endOffset),a=z(r,o+1,this.startContainer,this.startOffset);return t?0>=i&&a>=0:0>i&&a>0},isPointInRange:function(e,t){return T(this),N(e,"HIERARCHY_REQUEST_ERR"),R(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)>=0&&z(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return a(this,e,!1)},intersectsOrTouchesRange:function(e){return a(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=z(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=z(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==z(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==z(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new W("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==pt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,q(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return T(this),l(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=n(this),o=e.createRange(r);t=t||H.getBody(r),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,f=!1;!f&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),f=!0),n=o;else for(a=r.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return I.rangesEqual(this,e)},isValid:function(){return S(this)},inspect:function(){return u(this)},detach:function(){}}),b(I,P),B.extend(I,{rangeProperties:st,RangeIterator:h,copyComparisonConstants:x,createPrototypeRange:b,inspect:u,toHtml:O,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=I}),D.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,c=o.getBody,f=o.getContentDocument,d=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function r(e){for(var t,n=u.length;n--;)t=u[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}var d,l,u=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},s.createPrototypeRange(n,a),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},d.collapse=function(e){this.nativeRange.collapse(e),r(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){r(this)},d.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");c(document).appendChild(h);var g=document.createRange();g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},l=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(p){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}d.setStartBefore=l("setStartBefore","setEndBefore"),d.setStartAfter=l("setStartAfter","setEndAfter"),d.setEndBefore=l("setEndBefore","setStartBefore"),d.setEndAfter=l("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var m=document.createRange();m.selectNodeContents(h),m.setEnd(h,4),m.setStart(h,2),d.compareBoundaryPoints=-1==g.compareBoundaryPoints(g.START_TO_END,m)&&1==g.compareBoundaryPoints(g.END_TO_START,m)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var R=v.firstChild,C=c(document);C.appendChild(v),g.setStart(R,1),g.setEnd(R,2),g.deleteContents(),"13"==R.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),C.removeChild(v),C=null,i.isHostMethod(g,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(h),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var l=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},u=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(o.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var f=new a(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:f,nodeInfo:{nodeIndex:f.offset,containerElement:f.node}}}var l=o.getDocument(c).createElement("span");l.parentNode&&l.parentNode.removeChild(l);for(var u,h,g,p,m,v=n?"StartToStart":"StartToEnd",R=i&&i.containerElement==c?i.nodeIndex:0,C=c.childNodes.length,N=C,E=N;;){if(E==C?c.appendChild(l):c.insertBefore(l,c.childNodes[E]),s.moveToElementText(l),u=s.compareEndPoints(v,e),0==u||R==N)break;if(-1==u){if(N==R+1)break;R=E}else N=N==R+1?R:E;E=Math.floor((R+N)/2),c.removeChild(l)}if(m=l.nextSibling,-1==u&&m&&d(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var y;if(/[\r\n]/.test(m.data)){var S=s.duplicate(),T=S.text.replace(/\r\n/g,"\r").length;for(y=S.moveStart("character",T);-1==(u=S.compareEndPoints("StartToEnd",S));)y++,S.moveStart("character",1)}else y=s.text.length;p=new a(m,y)}else h=(r||!n)&&l.previousSibling,g=(r||n)&&l.nextSibling,p=g&&d(g)?new a(g,0):h&&d(h)?new a(h,h.data.length):new a(c,o.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},g=function(e,t){var n,r,i,a,s=e.offset,f=o.getDocument(e.node),l=c(f).createTextRange(),u=d(e.node);return u?(n=e.node,r=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,r=e.node),i=f.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),l.moveToElementText(i),l.collapse(!t),r.removeChild(i),u&&l[t?"moveStart":"moveEnd"]("character",s),l};r=function(e){this.textRange=e,this.refresh()},r.prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r=l(this.textRange);u(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(n=h(this.textRange,r,!0,!1),e=n.boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r);var p=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=p,r.prototype.toTextRange=function(){return p(this)
},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);"undefined"==typeof m.Range&&(m.Range=r),e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=f(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=f(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),D.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(x.isWindow(e))return e;if(e instanceof v)return e.win;var r=x.getContentDocument(e,t,n);return x.getWindow(r)}return window}function o(e){return r(e,"getWinSelection").getSelection()}function i(e){return r(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==x.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function c(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function f(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof D?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof P?n=t.nativeRange:B.implementsDomRange&&t instanceof x.getWindow(t.startContainer).Range&&(n=t),n}function l(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!x.isAncestorOf(e[0],e[t]))return!1;return!0}function u(e){var n=e.getNodes();if(!l(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&"undefined"!=typeof e.text}function g(e,t){var n=new P(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){if(t._ranges.length=0,"None"==t.docSelection.type)f(t);else{var n=t.docSelection.createRange();if(h(n))g(t,n);else{t.rangeCount=n.length;for(var r,o=W(n.item(0)),i=0;i<t.rangeCount;++i)r=e.createRange(o),r.selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var r=e.docSelection.createRange(),o=u(n),i=W(r.item(0)),a=L(i).createControlRange(),s=0,c=r.length;c>s;++s)a.add(r.item(s));try{a.add(o)}catch(f){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),p(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function C(e,t){for(var n,r,o=tt.length;o--;)if(n=tt[o],r=n.selection,"deleteAll"==t)R(r);else if(n.win==e)return"delete"==t?(tt.splice(o,1),!0):r;return"deleteAll"==t&&(tt.length=0),null}function N(e,n){for(var r,o=W(n[0].startContainer),i=L(o).createControlRange(),a=0,s=n.length;s>a;++a){r=u(n[a]);try{i.add(r)}catch(c){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),p(e)}function E(e,t){if(e.win.document!=W(t))throw new I("WRONG_DOCUMENT_ERR")}function y(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,r)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,r)),this.setSingleRange(o,this.isBackward())}}function S(e){var t=[],n=new H(e.anchorNode,e.anchorOffset),r=new H(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var i=0,a=e.rangeCount;a>i;++i)t[i]=D.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var T,w,O="boolean",A="number",x=e.dom,_=e.util,b=_.isHostMethod,D=e.DomRange,P=e.WrappedRange,I=e.DOMException,H=x.DomPosition,B=e.features,M="Control",W=x.getDocument,L=x.getBody,k=D.rangesEqual,F=b(window,"getSelection"),j=_.isHostObject(document,"selection");B.implementsWinGetSelection=F,B.implementsDocSelection=j;var z=j&&(!F||e.config.preferTextRange);z?(T=i,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||W(n.createRange().parentElement())==t}):F?(T=o,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=T;var U=T(),V=e.createNativeRange(document),q=L(document),Y=_.areHostProperties(U,["anchorNode","focusNode","anchorOffset","focusOffset"]);B.selectionHasAnchorAndFocus=Y;var $=b(U,"extend");B.selectionHasExtend=$;var Q=typeof U.rangeCount==A;B.selectionHasRangeCount=Q;var G=!1,X=!0,Z=$?function(t,n){var r=D.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(o)),t.extend(n.startContainer,n.startOffset)}:null;_.areHostMethods(U,["addRange","getRangeAt","removeAllRanges"])&&typeof U.rangeCount==A&&B.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],i=a(t),s=0;n>s;++s)o[s]=t.getRangeAt(s);var c=L(document),f=c.appendChild(document.createElement("div"));f.contentEditable="false";var d=f.appendChild(document.createTextNode("   ")),l=document.createRange();if(l.setStart(d,1),l.collapse(!0),t.addRange(l),X=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)G=!1;else{var h=l.cloneRange();l.setStart(d,0),h.setEnd(d,3),h.setStart(d,2),t.addRange(l),t.addRange(h),G=2==t.rangeCount}}for(c.removeChild(f),t.removeAllRanges(),s=0;n>s;++s)0==s&&i?Z?Z(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),B.selectionSupportsMultipleRanges=G,B.collapsedNonEditableSelectionsSupported=X;var J,K=!1;q&&b(q,"createControlRange")&&(J=q.createControlRange(),_.areHostProperties(J,["item","add"])&&(K=!0)),B.implementsControlRange=K,w=Y?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var et;b(U,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:Y&&(et=function(t){var n=W(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),v.prototype=e.selectionPrototype;var tt=[],nt=function(e){if(e&&e instanceof v)return e.refresh(),e;e=r(e,"getNativeSelection");var t=C(e),n=T(e),o=j?i(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new v(n,o,e),tt.push({win:e,selection:t})),t};e.getSelection=nt,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(x.getIframeWindow(n))};var rt=v.prototype;if(!z&&Y&&_.areHostMethods(U,["removeAllRanges","addRange"])){rt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),f(this)};var ot=function(e,t){Z(e.nativeSelection,t),e.refresh()};rt.addRange=Q?function(t,r){if(K&&j&&this.docSelection.type==M)m(this,t);else if(n(r)&&$)ot(this,t);else{var o;G?o=this.rangeCount:(this.removeAllRanges(),o=0);var i=d(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var c=et(this.nativeSelection,this.rangeCount-1);c&&!k(c,t)&&(t=new P(c))}this._ranges[this.rangeCount-1]=t,s(this,t,st(this.nativeSelection)),this.isCollapsed=w(this)}else this.refresh()}}:function(e,t){n(t)&&$?ot(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},rt.setRanges=function(e){if(K&&j&&e.length>1)N(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(b(U,"empty")&&b(V,"select")&&K&&z))return t.fail("No means of selecting a Range or TextRange was found"),!1;rt.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=W(this.anchorNode);else if(this.docSelection.type==M){var t=this.docSelection.createRange();t.length&&(e=W(t.item(0)))}if(e){var n=L(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}f(this)},rt.addRange=function(t){this.docSelection.type==M?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},rt.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?N(this,e):t&&this.addRange(e[0])}}rt.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var it;if(z)it=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=L(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==M?p(t):h(n)?g(t,n):f(t)};else if(b(U,"getRangeAt")&&typeof U.rangeCount==A)it=function(t){if(K&&j&&t.docSelection.type==M)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],st(t.nativeSelection)),t.isCollapsed=w(t)}else f(t)};else{if(!Y||typeof U.isCollapsed!=O||typeof V.collapsed!=O||!B.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;it=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=et(n,0),e._ranges=[t],e.rangeCount=1,c(e),e.isCollapsed=w(e)):f(e)}}rt.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(it(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!k(t[o],this._ranges[o]))return!0;return!1}};var at=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;o>r;++r)k(t,n[r])||e.addRange(n[r]);e.rangeCount||f(e)};rt.removeRange=K&&j?function(e){if(this.docSelection.type==M){for(var t,n=this.docSelection.createRange(),r=u(e),o=W(n.item(0)),i=L(o).createControlRange(),a=!1,s=0,c=n.length;c>s;++s)t=n.item(s),t!==r||a?i.add(n.item(s)):a=!0;i.select(),p(this)}else at(this,e)}:function(e){at(this,e)};var st;!z&&Y&&B.implementsDomRange?(st=a,rt.isBackward=function(){return st(this)}):st=rt.isBackward=function(){return!1},rt.isBackwards=rt.isBackward,rt.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},rt.collapse=function(t,n){E(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},rt.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},rt.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},rt.selectAllChildren=function(t){E(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},rt.deleteFromDocument=function(){if(K&&j&&this.docSelection.type==M){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;o>r;++r)n[r].deleteContents();this.addRange(n[o-1])}}},rt.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},rt.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},rt.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},rt.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t))}),n},rt.setStart=y(!0),rt.setEnd=y(!1),e.rangePrototype.select=function(e){nt(this.getDocument()).setSingleRange(this,e)},rt.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},rt.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},rt.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},rt.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)r=e.createRange(this.win),r.moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},rt.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(D.toHtml(t))}),e.join("")},B.implementsTextRange&&(rt.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(h(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),rt.getName=function(){return"WrappedSelection"},rt.inspect=function(){return S(this)},rt.detach=function(){C(this.win,"delete"),R(this)},v.detachAll=function(){C(null,"deleteAll")},v.inspect=S,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=rt,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return nt(e)}),e=null})});var M=!1,W=function(){M||(M=!0,!D.initialized&&D.config.autoInitialize&&l())};return _&&("complete"==document.readyState?W():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",W,!1),I(window,"load",W))),D},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function o(e){return e&&e.split(/\s+/).sort().join(" ")}function a(e){return o(e.className)}function s(e,t){return a(e)==a(t)}function c(e,t){for(var n=t.split(/\s+/),o=0,i=n.length;i>o;++o)if(!P(e,r(n[o])))return!1;return!0}function f(e,t,n,r,o){var i=e.node,a=e.offset,s=i,c=a;i==r&&a>o&&++c,i!=t||a!=n&&a!=n+1||(s=r,c+=o-n),i==t&&a>n+1&&--c,e.node=s,e.offset=c}function d(e,t,n){e.node==t&&e.offset>n&&--e.offset}function l(e,t,n,r){-1==n&&(n=t.childNodes.length);var o=e.parentNode,i=B.getNodeIndex(e);k(r,function(e){f(e,o,i,t,n)}),t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function u(e,t){var n=e.parentNode,r=B.getNodeIndex(e);k(t,function(e){d(e,n,r)}),e.parentNode.removeChild(e)}function h(e,t,n,r,o){for(var i,a=[];i=e.firstChild;)l(i,t,n++,o),a.push(i);return r&&u(e,o),a}function g(e,t){return h(e,e.parentNode,B.getNodeIndex(e),!0,t)}function p(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e),o=r?r.toString():"";return""!=o}function m(e){for(var t,n=e.getNodes([3]),r=0;(t=n[r])&&!p(e,t);)++r;for(var o=n.length-1;(t=n[o])&&!p(e,t);)--o;return n.slice(r,o+1)}function v(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,o,i=0,a=e.attributes.length;a>i;++i)if(n=e.attributes[i],o=n.name,"class"!=o){if(r=t.attributes.getNamedItem(o),null===n!=(null===r))return!1;if(n.specified!=r.specified)return!1;if(n.specified&&n.nodeValue!==r.nodeValue)return!1}return!0}function R(e,t){for(var n,r=0,o=e.attributes.length;o>r;++r)if(n=e.attributes[r].name,(!t||!W(t,n))&&e.attributes[r].specified&&"class"!=n)return!0;return!1}function C(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||z(e)&&!z(e.parentNode))}function N(e){return(z(e)||1!=e.nodeType&&z(e.parentNode))&&!C(e)}function E(e){return e&&1==e.nodeType&&!U.test(j(e,"display"))}function y(e){if(0==e.data.length)return!0;if(V.test(e.data))return!1;var t=j(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return E(e.previousSibling)||E(e.nextSibling)}function S(e){var t,n,r=[];for(t=0;n=e[t++];)r.push(new M(n.startContainer,n.startOffset),new M(n.endContainer,n.endOffset));return r}function T(e,t){for(var n,r,o,i=0,a=e.length;a>i;++i)n=e[i],r=t[2*i],o=t[2*i+1],n.setStartAndEnd(r.node,r.offset,o.node,o.offset)}function w(e,t){return B.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function O(e,n,r,o){var i,a,s=0==r;if(B.isAncestorOf(n,e))return e;if(B.isCharacterDataNode(n)){var c=B.getNodeIndex(n);if(0==r)r=c;else{if(r!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+r+" in "+n.data);r=c+1}n=n.parentNode}if(w(n,r)){i=n.cloneNode(!1),a=n.parentNode,i.id&&i.removeAttribute("id");for(var f,d=0;f=n.childNodes[r];)l(f,i,d++,o);return l(i,a,B.getNodeIndex(n)+1,o),n==e?i:O(e,a,B.getNodeIndex(i),o)}if(e!=n){i=n.parentNode;var u=B.getNodeIndex(n);return s||u++,O(e,i,u,o)}return e}function A(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&s(e,t)&&v(e,t)&&"inline"==j(e,"display")&&"inline"==j(t,"display")}function x(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var o=n.parentNode,i=n[t];if(i){if(i&&3==i.nodeType)return i}else if(r&&(i=o[t],i&&1==i.nodeType&&A(o,i))){var a=i[e?"firstChild":"lastChild"];if(a&&3==a.nodeType)return a}return null}}function _(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function b(e,t,i){var a,s,c,f,d=this;d.cssClass=d.className=e;var l=null,u={};if("object"==typeof t&&null!==t){for("undefined"!=typeof t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),i=t.tagNames,l=t.elementProperties,u=t.elementAttributes,s=0;f=$[s++];)t.hasOwnProperty(f)&&(d[f]=t[f]);a=t.normalize}else a=t;d.normalize="undefined"==typeof a?!0:a,d.attrExceptions=[];var h=document.createElement(d.elementTagName);d.elementProperties=d.copyPropertiesToElement(l,h,!0),n(u,function(e){d.attrExceptions.push(e)}),d.elementAttributes=u,d.elementSortedClassName=d.elementProperties.hasOwnProperty("className")?o(d.elementProperties.className+" "+e):e,d.applyToAnyTagName=!1;var g=typeof i;if("string"==g)"*"==i?d.applyToAnyTagName=!0:d.tagNames=r(i.toLowerCase()).split(/\s*,\s*/);else if("object"==g&&"number"==typeof i.length)for(d.tagNames=[],s=0,c=i.length;c>s;++s)"*"==i[s]?d.applyToAnyTagName=!0:d.tagNames.push(i[s].toLowerCase());else d.tagNames=[d.elementTagName]}function D(e,t,n){return new b(e,t,n)}var P,I,H,B=e.dom,M=B.DomPosition,W=B.arrayContains,L=B.isHtmlNamespace,k=e.util.forEach,F="span";e.util.isHostObject(document.createElement("div"),"classList")?(P=function(e,t){return e.classList.contains(t)},I=function(e,t){return e.classList.add(t)},H=function(e,t){return e.classList.remove(t)}):(P=function(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)},I=function(e,t){e.className?P(e,t)||(e.className+=" "+t):e.className=t},H=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}());var j=B.getComputedStyleProperty,z=function(){var e=document.createElement("div");return"boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||z(e.parentNode):!1}}(),U=/^inline(-block|-table)?$/i,V=/[^\r\n\t\f \u200B]/,q=x(!1),Y=x(!0);_.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){var r,o=B.getNodeIndex(n),i=[],a=0;k(t,function(t,s){r=t.parentNode,s>0&&(r.removeChild(t),r.hasChildNodes()||r.parentNode.removeChild(r),e&&k(e,function(e){e.node==t&&(e.node=n,e.offset+=a),e.node==r&&e.offset>o&&(--e.offset,e.offset==o+1&&s<len-1&&(e.node=n,e.offset=a))})),i[s]=t.data,a+=t.data.length}),n.data=i.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return k(this.textNodes,function(t,n){e[n]="'"+t.data+"'"}),"[Merge("+e.join(",")+")]"}};var $=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],Q={};b.prototype={elementTagName:F,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,i,a,s,c,f,d={};for(var l in e)if(e.hasOwnProperty(l))if(s=e[l],c=t[l],"className"==l)I(t,s),I(t,this.className),t[l]=o(t[l]),n&&(d[l]=s);else if("style"==l){i=c,n&&(d[l]=a={});for(r in e[l])e[l].hasOwnProperty(r)&&(i[r]=s[r],n&&(a[r]=i[r]));this.attrExceptions.push(l)}else t[l]=s,n&&(d[l]=t[l],f=Q.hasOwnProperty(l)?Q[l]:l,this.attrExceptions.push(f));return n?d:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return W(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&P(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||N(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&y(e)},postApply:function(e,t,n,r){var o,a,s=e[0],c=e[e.length-1],f=[],d=s,l=c,u=0,h=c.length;k(e,function(e){a=q(e,!r),a?(o||(o=new _(a),f.push(o)),o.textNodes.push(e),e===s&&(d=o.textNodes[0],u=d.length),e===c&&(l=o.textNodes[0],h=o.getLength())):o=null});var g=Y(c,!r);if(g&&(o||(o=new _(c),f.push(o)),o.textNodes.push(g)),f.length){for(i=0,len=f.length;i<len;++i)f[i].doMerge(n);t.setStartAndEnd(d,u,l,h)}},createContainer:function(e){var t=e.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),I(t,this.className),this.onElementCreate&&this.onElementCreate(t,this),t},elementHasProperties:function(e,t){var r=this;return n(t,function(t,n){if("className"==t)return c(e,n);if("object"==typeof n){if(!r.elementHasProperties(e[t],n))return!1}else if(e[t]!==n)return!1})},elementHasAttributes:function(e,t){return n(t,function(t,n){return e.getAttribute(t)!==n?!1:void 0})},applyToTextNode:function(e){var t=e.parentNode;if(1==t.childNodes.length&&this.useExistingElements&&L(t)&&this.appliesToElement(t)&&this.elementHasProperties(t,this.elementProperties)&&this.elementHasAttributes(t,this.elementAttributes))I(t,this.className);else{var n=this.createContainer(B.getDocument(e));e.parentNode.insertBefore(n,e),n.appendChild(e)}},isRemovable:function(e){return L(e)&&e.tagName.toLowerCase()==this.elementTagName&&a(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!R(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),r=[e],o=S(r);k(n,function(e){u(e,o)}),T(r,o)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var o=t.cloneRange();o.selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(O(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=O(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?g(n,r):H(n,this.className)},splitAncestorWithClass:function(e,t,n){var r=this.getSelfOrAncestorWithClass(e);r&&O(r,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?g(e,t):H(e,this.className)},applyToRange:function(e,t){var n=this;t=t||[];var r=S(t||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e);var o=m(e);if(o.length){k(o,function(e){n.isIgnorableWhiteSpaceNode(e)||n.getSelfOrAncestorWithClass(e)||!n.isModifiable(e)||n.applyToTextNode(e,r)});var i=o[o.length-1];e.setStartAndEnd(o[0],0,i,i.length),n.normalize&&n.postApply(o,e,r,!1),T(t,r)}var a=n.getEmptyElements(e);k(a,function(e){I(e,n.className)})},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n=this;t=t||[];var r=S(t);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e,r);var o,i,a=m(e),s=a[a.length-1];if(a.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,r),n.splitAncestorWithClass(e.startContainer,e.startOffset,r);for(var c=0,f=a.length;f>c;++c)o=a[c],i=n.getSelfOrAncestorWithClass(o),i&&n.isModifiable(o)&&n.undoToAncestor(i,r);e.setStartAndEnd(a[0],0,s,s.length),n.normalize&&n.postApply(a,e,r,!0),T(t,r)}var d=n.getEmptyElements(e);k(d,function(e){H(e,n.className)})},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,r=0;n=t[r++];)if(!this.isIgnorableWhiteSpaceNode(n)&&p(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!W(t,r)&&t.push(r)}),t},detach:function(){}},b.util={hasClass:P,addClass:I,removeClass:H,hasSameClasses:s,hasAllClasses:c,replaceWithOwnChildren:g,elementsHaveSameNonClassAttributes:v,elementHasNonClassAttributes:R,splitNodeAt:O,isEditableElement:z,isEditingHost:C,isEditable:N},e.CssClassApplier=e.ClassApplier=b,e.createCssClassApplier=e.createClassApplier=D}),e},this);